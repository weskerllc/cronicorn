{
  "category": "Uncategorized",
  "description": "TASK 13: Add Try-Catch Error Handling to Unprotected Route Handlers\nPriority: HIGH | Type: Resilience | Estimated scope: 2-3 files\n\nContext:\nSeveral route handlers lack try-catch blocks. The global error handler at apps/api/src/app.ts:76 (app.onError(errorHandler)) catches unhandled errors, but the error handler at apps/api/src/lib/error-handler.ts only logs and returns a generic 500. Without try-catch in handlers, specific error types (like \"not found\", \"limit reached\") get swallowed into generic 500s.\n\nThe handlers that rely solely on the global error handler (no local try-catch):\n\napps/api/src/routes/dashboard/dashboard.handlers.ts — both getDashboardStats and getDashboardActivity\napps/api/src/routes/devices/devices.handlers.ts — listConnectedDevices (lines 9-32) — the revokeDevice handler already has error handling\nWhat to implement:\n\nCheck apps/api/src/lib/error-handler.ts — verify it handles ZodError, business logic errors, and database errors distinctly. If it only does generic 500, enhance it to:\n\nReturn 400 for ZodError (validation failures)\nReturn 404 for \"not found\" errors\nReturn 409 for \"already exists\" or conflict errors\nReturn 500 for everything else with safe error messages (no stack traces)\nVerify the global onError handler is sufficient for the dashboard and device handlers. If the handlers use the withDashboardManager transaction wrapper (they do — see dashboard.handlers.ts lines 15 and 33), errors from the manager will bubble up through the transaction and be caught by onError. If this is already working correctly, document it and move on.\n\nIf there are any handlers that bypass the transaction wrapper and call repos directly, add explicit try-catch blocks.\n\nKey files:\n\napps/api/src/lib/error-handler.ts — the global handler\napps/api/src/lib/error-utils.ts — safe error patterns\napps/api/src/routes/dashboard/dashboard.handlers.ts\napps/api/src/routes/devices/devices.handlers.ts\nConventions:\n\nCommit as fix(api): improve error handling in route handlers\nUse the existing safeErrorMessage() utility from error-utils.ts",
  "title": "Add try-catch error handling to route handlers",
  "images": [],
  "imagePaths": [],
  "textFilePaths": [],
  "skipTests": true,
  "model": "opus",
  "thinkingLevel": "none",
  "reasoningEffort": "none",
  "priority": 2,
  "planningMode": "spec",
  "requirePlanApproval": false,
  "dependencies": [],
  "workMode": "current",
  "titleGenerating": false,
  "status": "backlog",
  "id": "feature-1770420076250-ltrzkw4pj",
  "descriptionHistory": [
    {
      "description": "TASK 13: Add Try-Catch Error Handling to Unprotected Route Handlers\nPriority: HIGH | Type: Resilience | Estimated scope: 2-3 files\n\nContext:\nSeveral route handlers lack try-catch blocks. The global error handler at apps/api/src/app.ts:76 (app.onError(errorHandler)) catches unhandled errors, but the error handler at apps/api/src/lib/error-handler.ts only logs and returns a generic 500. Without try-catch in handlers, specific error types (like \"not found\", \"limit reached\") get swallowed into generic 500s.\n\nThe handlers that rely solely on the global error handler (no local try-catch):\n\napps/api/src/routes/dashboard/dashboard.handlers.ts — both getDashboardStats and getDashboardActivity\napps/api/src/routes/devices/devices.handlers.ts — listConnectedDevices (lines 9-32) — the revokeDevice handler already has error handling\nWhat to implement:\n\nCheck apps/api/src/lib/error-handler.ts — verify it handles ZodError, business logic errors, and database errors distinctly. If it only does generic 500, enhance it to:\n\nReturn 400 for ZodError (validation failures)\nReturn 404 for \"not found\" errors\nReturn 409 for \"already exists\" or conflict errors\nReturn 500 for everything else with safe error messages (no stack traces)\nVerify the global onError handler is sufficient for the dashboard and device handlers. If the handlers use the withDashboardManager transaction wrapper (they do — see dashboard.handlers.ts lines 15 and 33), errors from the manager will bubble up through the transaction and be caught by onError. If this is already working correctly, document it and move on.\n\nIf there are any handlers that bypass the transaction wrapper and call repos directly, add explicit try-catch blocks.\n\nKey files:\n\napps/api/src/lib/error-handler.ts — the global handler\napps/api/src/lib/error-utils.ts — safe error patterns\napps/api/src/routes/dashboard/dashboard.handlers.ts\napps/api/src/routes/devices/devices.handlers.ts\nConventions:\n\nCommit as fix(api): improve error handling in route handlers\nUse the existing safeErrorMessage() utility from error-utils.ts",
      "timestamp": "2026-02-06T23:21:16.593Z",
      "source": "initial"
    }
  ]
}
